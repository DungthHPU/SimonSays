<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>README - SimonSays RDOC</title>

<link href="./fonts.css" rel="stylesheet">
<link href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/navigation.js"></script>
<script src="./js/search_index.js"></script>
<script src="./js/search.js"></script>
<script src="./js/searcher.js"></script>
<script src="./js/darkfish.js"></script>


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-SimonSays%21">SimonSays!</a>
    <li><a href="#label-Installation">Installation</a>
    <li><a href="#label-Usage">Usage</a>
    <li><a href="#label-Roleable">Roleable</a>
    <li><a href="#label-Authorizer">Authorizer</a>
    <li><a href="#label-Contributing">Contributing</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./README_md.html">README</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page README.md">

<h1 id="label-SimonSays%21"><a href="SimonSays.html">SimonSays</a>!<span><a href="#label-SimonSays%21">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p><img
src="https://raw.githubusercontent.com/SimplyBuilt/SimonSays/master/SimonSays.png"></p>

<p>This gem is a simple, declarative, role-based access control system for
Rails that works great with devise! Take a look at the <a
href="http://simplybuilt.github.io/SimonSays">docs</a> for more details!</p>

<h2 id="label-Installation">Installation<span><a href="#label-Installation">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Add this line to your application&#39;s Gemfile:</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;simon_says&#39;</span>
</pre>

<p>Now execute:</p>

<pre>$ bundle</pre>

<p>Or install the gem directly via:</p>

<pre>$ gem install simon_says</pre>

<h2 id="label-Usage">Usage<span><a href="#label-Usage">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p><a href="SimonSays.html">SimonSays</a> consists of two parts. One is a
model concern called <code>Roleable</code>. The other is a controller
concern called <code>Authorizer</code>. The idea is that you give users
some set of roles and find and authorize resources against those roles on a
controller (and action) basis.</p>

<h3 id="label-Roleable">Roleable<span><a href="#label-Roleable">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>First, we need to define some roles. Generally speaking roles will exist on
either “User” models or on relationship models (like a through model
linking a User to another resource).</p>

<p>Here&#39;s a quick example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">SimonSays</span><span class="ruby-operator">::</span><span class="ruby-constant">Roleable</span>

  <span class="ruby-identifier">has_roles</span> :<span class="ruby-identifier">add</span>, :<span class="ruby-identifier">edit</span>, :<span class="ruby-identifier">delete</span>
<span class="ruby-keyword">end</span>
</pre>

<p>User can now have zero or more roles:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">roles</span>
=<span class="ruby-operator">&gt;</span> []

<span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">tap</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">u</span><span class="ruby-operator">|</span> <span class="ruby-identifier">u</span>.<span class="ruby-identifier">roles</span> = :<span class="ruby-identifier">add</span>, :<span class="ruby-identifier">edit</span> }.<span class="ruby-identifier">roles</span>
=<span class="ruby-operator">&gt;</span> [:<span class="ruby-identifier">add</span>, :<span class="ruby-identifier">edit</span>]
</pre>

<p>Roles are stored as an integer and bitmasking is used to determine
authorization logic. When using <code>Roleable</code> you need add a
<code>roles_mask</code> column. Note that we do not have any generators for
this yet. Feel free to fork and add them!</p>

<p>You can customize the role attribute using the <code>:as</code> option. For
example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Admin</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">SimonSays</span><span class="ruby-operator">::</span><span class="ruby-constant">Roleable</span>

  <span class="ruby-identifier">has_roles</span> :<span class="ruby-identifier">design</span>, :<span class="ruby-identifier">support</span>, :<span class="ruby-identifier">moderator</span>, <span class="ruby-identifier">as</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">access</span>
<span class="ruby-keyword">end</span>

<span class="ruby-constant">Admin</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">access</span>
=<span class="ruby-operator">&gt;</span> []

<span class="ruby-constant">Admin</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">access</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">support</span>).<span class="ruby-identifier">access</span>
=<span class="ruby-operator">&gt;</span> [:<span class="ruby-identifier">support</span>]
</pre>

<p>The <code>Roleable</code> will expect there to be a
<code>access_mask</code> column and attribute.</p>

<p>You can also use <code>Roleable</code> on through models. For example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Membership</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">SimonSays</span><span class="ruby-operator">::</span><span class="ruby-constant">Roleable</span>

  <span class="ruby-identifier">belongs_to</span> :<span class="ruby-identifier">user</span>
  <span class="ruby-identifier">belongs_to</span> :<span class="ruby-identifier">document</span>

  <span class="ruby-identifier">has_roles</span> :<span class="ruby-identifier">download</span>, :<span class="ruby-identifier">edit</span>, :<span class="ruby-identifier">delete</span>,
<span class="ruby-keyword">end</span>
</pre>

<p>Calling <code>has_roles</code> will dynamically generate several methods as
well as a dynamically named scope. Be sure to also checkout the <a
href="http://simplybuilt.github.io/SimonSays/SimonSays/Roleable/ClassMethods.html">docs</a>
for more details!</p>

<h3 id="label-Authorizer">Authorizer<span><a href="#label-Authorizer">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Next up is the <code>Authorizer</code>. This concern provides several
methods that can be used within your controllers to declaratively find
resources and ensure certain role-based conditions are met.</p>

<p><em>Please note</em>, certain assumptions are made with
<code>Authorizer</code>. Building upon the above <code>User</code> and
<code>Admin</code> models, <code>Authorizer</code> would assume there is a
<code>current_user</code> and <code>current_admin</code> method. If these
models correspond to devise scopes this would be the case by default.
Additionally there would need to be an <code>authenticate_user!</code> and
<code>authenticate_admin!</code> method, which devise provides as well.</p>

<p>Eventually, we would like to see better customization around the
authentication aspects. This library is intended to solve the problem of
authorization and access control. It is not an authentication library.</p>

<p>The first step is to include the concern within the
<code>ApplicationController</code> and to configure the default
authorization method:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">ApplicationController</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">SimonSays</span><span class="ruby-operator">::</span><span class="ruby-constant">Authorizer</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">default_authorization_scope</span> = :<span class="ruby-identifier">current_user</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Let&#39;s start with an example; here we&#39;ll create a reports resource
that only Admin&#39;s with support access to use. The roles are supplied
within the <code>authorize_resource</code> method. Note that, multiple
roles can be supplied; access is granted if one or more are met.</p>

<pre class="ruby"><span class="ruby-comment"># routes.rb</span>
<span class="ruby-comment"># Reports resource for Admins</span>
<span class="ruby-identifier">resources</span> :<span class="ruby-identifier">reports</span>

<span class="ruby-comment"># app/controllers/reports_controller.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">ReportsController</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ApplicationController</span>
  <span class="ruby-identifier">authorize_resource</span> :<span class="ruby-identifier">admin</span>, :<span class="ruby-identifier">support</span>
  <span class="ruby-identifier">find_resource</span> :<span class="ruby-identifier">report</span>, <span class="ruby-identifier">except</span><span class="ruby-operator">:</span> [:<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">new</span>, :<span class="ruby-identifier">create</span>]
<span class="ruby-keyword">end</span>
</pre>

<p>Here&#39;s another example using the <code>Membership</code> through model
and multiple calls to <code>find_and_authorize</code> to setup various
role-based requirements.</p>

<pre class="ruby"><span class="ruby-comment"># routes.rb</span>
<span class="ruby-identifier">resources</span> :<span class="ruby-identifier">documents</span>

<span class="ruby-comment"># app/controllers/documents_controller.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">DocumentsController</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ApplicationController</span>
  <span class="ruby-identifier">authenticate</span> :<span class="ruby-identifier">user</span>

  <span class="ruby-identifier">find_and_authorize</span> :<span class="ruby-identifier">documents</span>, :<span class="ruby-identifier">edit</span>, <span class="ruby-identifier">through</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">memberships</span>, <span class="ruby-identifier">only</span><span class="ruby-operator">:</span> [:<span class="ruby-identifier">edit</span>, :<span class="ruby-identifier">update</span>]
  <span class="ruby-identifier">find_and_authorize</span> :<span class="ruby-identifier">documents</span>, :<span class="ruby-identifier">delete</span>, <span class="ruby-identifier">through</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">memberships</span>, <span class="ruby-identifier">only</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">destroy</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The document model will not be found if the membership relationship does
not exist and an <code>ActiveRecord::NotFound</code> exception will be
raised.</p>

<p>If the membership record exists, but the role conditions are not met,
<code>Authorizer</code> will raise a <code>Denied</code> exception.</p>

<p>If the document is found and the user has the access to it. It will be set
as the <code>@document</code> instance variable. Be sure to checkout the <a
href="http://simplybuilt.github.io/SimonSays/SimonSays/Authorizer/ClassMethods.html">docs</a>
for more details!</p>

<h2 id="label-Contributing">Contributing<span><a href="#label-Contributing">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
<ol><li>
<p>Fork it ( <a
href="https://github.com/SimplyBuilt/SimonSays/fork">github.com/SimplyBuilt/SimonSays/fork</a>
)</p>
</li><li>
<p>Create your feature branch (<code>git checkout -b my-new-feature</code>)</p>
</li><li>
<p>Commit your changes (<code>git commit -am &#39;Add some
feature&#39;</code>)</p>
</li><li>
<p>Push to the branch (<code>git push origin my-new-feature</code>)</p>
</li><li>
<p>Create a new Pull Request</p>
</li></ol>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

